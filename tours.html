<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MileZeroTours Listings</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
      overflow-y: scroll;
      scroll-behavior: smooth;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .tour-card {
  background-color: #fff;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 20px;
  transition: box-shadow 0.3s ease;
  display: flex;
  align-items: flex-start; /* Align items to the start (top) */
}


    .tour-card:hover {
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }

    .tour-info {
      padding: 20px;
      flex: 1; /* Take remaining space */
    }

    .tour-info h1 {
      font-size: 28px; /* Increased font size */
      margin: 0 0 10px;
      color: #333;
    }

    .tour-info h2 {
      font-size: 20px; /* Increased font size */
      margin: 0 0 10px;
      color: #666;
    }

    .tour-info img {
  max-width: 200px; /* Adjusted image size */
  height: auto;
  border-radius: 8px;
  margin-right: 20px; /* Added margin for spacing */
  vertical-align: top; /* Align the image to the top */
}


    .btn {
      display: inline-block;
      padding: 10px 20px;
      padding-left: 10px;
      padding-right: 10px;
      background-color: #4CAF50;
      color: #fff;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s ease;
    }

    .btn:hover {
      background-color: #45a049;
    }

    aside {
      background-color: #FFFFFF;
      border-bottom: 3px solid black;
      padding-top: 0px;
      padding-bottom: 10px;
      margin-bottom: 20px; /* Added margin for spacing */
      border-radius: 8px; /* Added border radius */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Added box shadow */
    }

    h3 {
      color: #FFFFFF;
      font-size: 20px;
      margin-bottom: 0;
      background-color: #000000;
      border-left: 20px solid #000000;
      border-bottom: 8px solid #000000;
      padding: 10px 20px; /* Added padding for better appearance */
      border-radius: 8px; /* Added border radius */
    }

    label {
      display: block;
      margin-top: 10px;
    }

    select {
      margin-bottom: 10px;
    }
  </style>
</head>
<body onload="start()">
  <div class="container" id="tours-container"></div>

  <aside>
    <h3>Filter Tours</h3>
    <label for="season-filter">Season:</label>
    <select id="season-filter">
      <option value="">All</option>
      <option value="spring">Spring</option>
      <option value="summer">Summer</option>
      <option value="fall">Fall</option>
      <option value="winter">Winter</option>
    </select>
    <label for="location-filter">Destination:</label>
    <select id="location-filter">
      <option value="">All</option>
      <option value="bc">BC</option>
      <option value="canada">Canada</option>
      <option value="international">International/USA</option>
    </select>
    <label for="depart-from-filter">Depart From:</label>
    <select id="depart-from-filter">
      <option value="">All</option>
      <option value="vancouver">Vancouver</option>
      <option value="victoria">Victoria</option>
    </select>
    <button id="apply-filters-btn">Apply Filters</button>
  </aside>
  
<body onload="start()">
  <div class="container" id="tours-container"></div>
  
Copyright 2024 MileZeroTours LTD 
  <script>
  // Function to fetch tours and apply filters
  function fetchToursAndApplyFilters() {
    const SPREADSHEET_ID = "1o0AUq13j-7LZWDhCwFYgq07niZtvOya5iE5bbRQMGWc";
    const API_KEY = "AIzaSyAhgfTNBOeYYRTjpboOGbZsc-XZH8T6Xbw";
    const SHEET_NAME = "Sheet2";
    const toursContainer = document.getElementById("tours-container");

    // Fetch filter elements
    const seasonFilter = document.getElementById("season-filter");
    const locationFilter = document.getElementById("location-filter");
    const departFromFilter = document.getElementById("depart-from-filter");

    // Fetch tours data and apply filters
    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME}!A1:AK100?key=${API_KEY}`)
      .then(response => response.json())
      .then(data => {
        const values = data.values;

        // Clear previous tours
        toursContainer.innerHTML = "";

        for (let i = 1; i < values.length; i++) {
          const tourName = values[i][1];
          const tourDates = values[i][5];
          const offer = values[i][20];
          const Description = values[i][21];
          const imageUrl = values[i][28];
          const Destination = values[i][18];
          const DepartFrom = values[i][19];
          const price = values[i][6];
          const Season = values[i][17];
          const id = values[i][0];

          // Filter by season
          if (seasonFilter.value !== "" && !Season.toLowerCase().includes(seasonFilter.value.toLowerCase())) {
            continue; // skip this row if it doesn't match the season filter
          }

          // Filter by location
          if (locationFilter.value !== "" && locationFilter.value !== Destination.toLowerCase()) {
            continue; // skip this row if it doesn't match the location filter
          }

          // Filter by depart from
          if (departFromFilter.value !== "" && !DepartFrom.toLowerCase().includes(departFromFilter.value.toLowerCase())) {
            continue; // skip this row if it doesn't match the depart from filter
          }

          // Create HTML elements for each tour
          const tourElement = document.createElement("div");
          tourElement.classList.add("tour-card");

          const img = document.createElement("img");
          img.src = imageUrl;
          img.alt = "Image for " + tourName;
          img.style.maxWidth = "200px"; // Adjust image size here

          const h1 = document.createElement("h1");
          h1.textContent = tourName;

          const h2 = document.createElement("h2");
          h2.textContent = tourDates;

          const h3 = document.createElement("h3");
          h3.textContent = offer;

          const h4 = document.createElement("h4");
          h4.textContent = `Destination: ${Destination}, Departs from: ${DepartFrom}, Price: $${price}`;

          const p = document.createElement("p");
          p.textContent = Description;

          const detailButton = document.createElement("a");
          detailButton.href = `https://testingtours.github.io/mztdemo/tour-details#tour=${id}`;
          detailButton.textContent = "Tour Details";
          detailButton.classList.add("btn");
          detailButton.style.marginRight = "10px"; // Adjust the margin as needed

          const bookButton = document.createElement("a");
          bookButton.textContent = "Book Now";
          bookButton.classList.add("btn");


// Inside the fetchToursAndApplyFilters function, where the bookButton event listener is attached
bookButton.addEventListener("click", function(event) {
  const Name = tourName
  const Dates = tourDates
  const Id = id; // Get tour ID

  showBookingIframe(Name, Dates, Id);
});




          tourElement.appendChild(img);
          const infoContainer = document.createElement("div");
          infoContainer.classList.add("tour-info");
          infoContainer.appendChild(h1);
          infoContainer.appendChild(h2);
          infoContainer.appendChild(h3);
          infoContainer.appendChild(h4);
          infoContainer.appendChild(p);
          infoContainer.appendChild(detailButton);
          infoContainer.appendChild(bookButton);
          tourElement.appendChild(infoContainer);

          toursContainer.appendChild(tourElement);
        }
      })
      .catch(error => console.error("Error fetching tours:", error));
  }
function showBookingIframe(name, dates, id) {
   
    
     // Create overlay element
  const overlay = document.createElement("div");
  overlay.style.position = "fixed";
  overlay.style.top = "0";
  overlay.style.left = "0";
  overlay.style.width = "100%";
  overlay.style.height = "100%";
  overlay.style.backgroundColor = "rgba(0, 0, 0, 0.5)"; // Semi-transparent black background
  overlay.style.backdropFilter = "blur(5px)"; // Apply blur effect
  overlay.style.zIndex = "9998"; // Ensure the overlay is below the iframe
  overlay.addEventListener("click", function() {
    // Remove overlay when clicked
    document.body.removeChild(overlay);
    document.body.removeChild(iframe);
  });
  document.body.appendChild(overlay);

    // Create iframe element
  const iframe = document.createElement("iframe");
  iframe.style.position = "fixed";
  iframe.style.top = "50%";
  iframe.style.left = "50%";
  iframe.style.transform = "translate(-50%, -50%)";
  iframe.style.width = "80%";
  iframe.style.height = "80%";
  iframe.style.border = "none";
  iframe.style.zIndex = "9999";
  iframe.style.backgroundColor = "white";

  iframe.addEventListener("load", function() {
    // Create HTML content to be displayed in the iframe
    const bookingFormContent = `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> ${name} Tour Booking-- MileZeroTours</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f2f2f2;
    margin: 0;
    padding: 0;
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }

  h2 {
    font-size: 24px;
    color: #333;
    margin-bottom: 20px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  label {
    font-weight: bold;
    color: #666;
    margin-bottom: 8px;
    display: block;
  }

  input[type="text"], input[type="email"], input[type="tel"], select, textarea {
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
    border: 1px solid #ccc;
    border-radius: 4px;
    transition: border-color 0.3s;
  }

  input[type="text"]:focus, input[type="email"]:focus, input[type="tel"]:focus, select:focus, textarea:focus {
    border-color: #66afe9;
  }

  textarea {
    height: 100px;
  }

  button[type="submit"] {
    background-color: #4CAF50;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
  }

  button[type="submit"]:hover {
    background-color: #45a049;
  }

  .error-message {
    color: red;
    margin-top: 10px;
  }
</style>
</head>
<body>

<div class="container">
  <h1>${name}</h1>
    <h3>Book your trip on the ${name} with milezerotours. </h3>
    <h4> ${dates}</h4>
  <form id="bookingForm">

    <div class="form-group">
      <h3>Number of People</h3>
      <label for="numberOfPeople">Number of People:</label>
      <select id="numberOfPeople" name="numberOfPeople" required>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
      </select>
    </div>

    <div id="guestDetails" class="form-group">
      <!-- Guest details will be dynamically inserted here -->
    </div>

    <div id="contactDetails" class="form-group">
      <!-- Contact details will be dynamically inserted here -->
    </div>

    <div class="form-group">
      <h3>Special Requests</h3>
      <label for="specialRequests">Special Requests:</label>
      <textarea id="specialRequests" name="specialRequests" rows="4"></textarea>
    </div>

    <div class="form-group">
      <h3>Additional Information</h3>
      <iframe src="https://milezerotours.com/terms-of-travel" width="100%" height="300"></iframe>
    </div>

    <div class="form-group">
      <input type="checkbox" id="acceptTerms" name="acceptTerms" required>
      <label for="acceptTerms">I agree to the Terms and Conditions</label>
    </div>

    <button type="submit">Submit</button>
    <div id="errorBox" class="error-message" style="display: none;">Please fill out all required fields.</div>
  </form>
</div>

<script>
  // Function to show/hide guest details based on number of people
  function updateGuestDetails() {
    var numberOfPeople = parseInt(document.getElementById('numberOfPeople').value);
    var guestDetailsDiv = document.getElementById('guestDetails');
    guestDetailsDiv.innerHTML = ''; // Clear existing content

    for (var i = 0; i < numberOfPeople; i++) {
      var guestIndex = i + 1;
      var guestDetails = \`
        <div class="guest-details">
          <h3>Guest \${guestIndex}</h3>
          <label for="firstName\${guestIndex}">First Name:</label>
          <input type="text" id="firstName\${guestIndex}" name="firstName\${guestIndex}" required>

          <label for="lastName\${guestIndex}">Last Name:</label>
          <input type="text" id="lastName\${guestIndex}" name="lastName\${guestIndex}" required>

          <label for="dob\${guestIndex}">Date of Birth:</label>
          <input type="date" id="dob\${guestIndex}" name="dob\${guestIndex}" required>
        </div>
      \`;
      guestDetailsDiv.insertAdjacentHTML('beforeend', guestDetails);
    }

    // Update contact details based on the number of people
    updateContactDetails(numberOfPeople);
  }

  // Function to update contact details based on the number of people
  function updateContactDetails(numberOfPeople) {
    var contactDetailsDiv = document.getElementById('contactDetails');
    contactDetailsDiv.innerHTML = ''; // Clear existing content

    var contactDetails = \`
      <h3>Contact Details</h3>
      <label for="address">Address:</label>
      <input type="text" id="address" name="address" required>

      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required>

      <label for="phone">Phone:</label>
      <input type="tel" id="phone" name="phone" required>
    \`;
    contactDetailsDiv.insertAdjacentHTML('beforeend', contactDetails);

    // Add more contact details sections based on the number of people
    for (var i = 1; i < numberOfPeople; i++) {
      var guestIndex = i + 1;
      var additionalContactDetails = \`
        <h3>Contact Details for Guest \${guestIndex}</h3>  <input type="checkbox" id="guest0" name="vehicle1" value="True">
      <label for="guest0"> Same as guest 1</label><br>
        <label for="address\${guestIndex}">Address:</label>
        <input type="text" id="address\${guestIndex}" name="address\${guestIndex}" required>

        <label for="email\${guestIndex}">Email:</label>
        <input type="email" id="email\${guestIndex}" name="email\${guestIndex}" required>

        <label for="phone\${guestIndex}">Phone:</label>
        <input type="tel" id="phone\${guestIndex}" name="phone\${guestIndex}" required>
      \`;
      contactDetailsDiv.insertAdjacentHTML('beforeend', additionalContactDetails);
    }
  }

  // Trigger update on page load and when dropdown changes
  document.addEventListener('DOMContentLoaded', function() {
    updateGuestDetails();
  });
  document.getElementById('numberOfPeople').addEventListener('change', function() {
    updateGuestDetails();
  });

    document.getElementById("guest0").addEventListener("change", function() {
  var isChecked = this.checked;
  var toReplaceDiv = document.getElementById("toReplace");
  
  if (isChecked) {
    // Create new paragraph element
    var newParagraph = document.createElement("p");
    newParagraph.textContent = "This is the new content after checkbox is checked.";

    // Remove existing content
    while (toReplaceDiv.firstChild) {
      toReplaceDiv.removeChild(toReplaceDiv.firstChild);
    }
    
    // Append the new paragraph to the div
    toReplaceDiv.appendChild(newParagraph);
  } else {
    // If unchecked, add back the elements
    toReplaceDiv.innerHTML = ``
      <label for="address\${guestIndex}">Address:</label>
      <input type="text" id="address\${guestIndex}" name="address\${guestIndex}" required>

      <label for="email\${guestIndex}">Email:</label>
      <input type="email" id="email\${guestIndex}" name="email\${guestIndex}" required>

      <label for="phone\${guestIndex}">Phone:</label>
      <input type="tel" id="phone\${guestIndex}" name="phone\${guestIndex}" required>
   
    `;
}
  // Form submission validation
  document.getElementById('bookingForm').addEventListener('submit', function(event) {
    var form = event.target;
    var requiredFields = form.querySelectorAll('[required]');
    var errorBox = document.getElementById('errorBox');
    var incompleteFields = [];

    requiredFields.forEach(function(field) {
      if (!field.value) {
        incompleteFields.push(field.getAttribute('name'));
      }
    });

    if (incompleteFields.length > 0) {
      event.preventDefault();
      errorBox.style.display = 'block';
      errorBox.textContent = 'Please fill out all the info to book this tour: ' + incompleteFields.join(', ');
    } else {
      errorBox.style.display = 'none';
    }
  });
  
     function serializeFormToJson(form) {
    var formData = new FormData(form);
    var jsonData = {};

    // Add tour and number of people directly
    jsonData['tourCode'] = "${id}";
    jsonData['tour'] = formData.get('tour');
    jsonData['numberOfPeople'] = formData.get('numberOfPeople');

    // Add guest details
    var numberOfPeople = parseInt(jsonData['numberOfPeople']);
    for (var i = 1; i <= 3; i++) {
      var guestIndex = i.toString();
      if (i <= numberOfPeople) {
        // If guest exists, add their details
        jsonData['firstName' + guestIndex] = formData.get('firstName' + guestIndex);
        jsonData['lastName' + guestIndex] = formData.get('lastName' + guestIndex);
        jsonData['dob' + guestIndex] = formData.get('dob' + guestIndex);
      } else {
        // If guest does not exist, set details to null
        jsonData['firstName' + guestIndex] = null;
        jsonData['lastName' + guestIndex] = null;
        jsonData['dob' + guestIndex] = null;
      }
    }

    // Add contact details
    jsonData['address'] = formData.get('address');
    jsonData['email'] = formData.get('email');
    jsonData['phone'] = formData.get('phone');

    // Add special requests
    jsonData['specialRequests'] = formData.get('specialRequests');

    // Add terms acceptance
    jsonData['acceptTerms'] = formData.get('acceptTerms');

    return jsonData;
  }
  
   function submitForm(event) {
    event.preventDefault(); // Prevent default form submission
    var form = event.target;
    var jsonData = serializeFormToJson(form);

    // Send JSON data to the specified endpoint
    fetch('https://hook.us1.make.com/274b8bhxr683ap1861xr7i23f35cqmsd', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(jsonData)
    })
    .then(function(response) {
      if (response.ok) {
        window.location.href = "https://example.com";
        form.reset(); // Reset the form after successful submission
      } else {
        throw new Error('Failed to submit form');
      }
    })
    .catch(function(error) {
      console.error('Error:', error);
      alert('Failed to submit form. Please try again later.');
    });
  }

  // Attach form submission handler
  document.getElementById('bookingForm').addEventListener('submit', submitForm); \<\/script\> `
    // Access the document body of the iframe
    const iframeDocument = iframe.contentWindow.document;

    // Set HTML content inside the iframe
    iframeDocument.open();
    iframeDocument.write(bookingFormContent);
    iframeDocument.close();
  });

  // Append iframe to the body
  document.body.appendChild(iframe);
}


  // Function to start filtering when the page loads
   function start() {
    const applyFiltersBtn = document.getElementById('apply-filters-btn');

    // Apply filters when the button is found
    if (applyFiltersBtn) {
      applyFiltersBtn.addEventListener("click", fetchToursAndApplyFilters);
      applyFiltersBtn.click(); // Apply filters on page load
    } else {
      console.error('Button not found.');
    }


    // Move filters to the top of the page
    const filtersAside = document.querySelector('aside');
    const body = document.querySelector('body');
    body.insertBefore(filtersAside, body.firstChild);

    // Add event listener to book buttons
    const bookButtons = document.querySelectorAll('.btn.book-btn');
    bookButtons.forEach(button => {
      button.addEventListener('click', showBookingIframe);
    });
  }

  // Call the start function to execute the code
  start();
</script>
